"use strict";angular.module("d3",[]).factory("d3Service",["$document","$q","$rootScope",function(t,e,a){function r(){a.$apply(function(){n.resolve(window.d3)})}var n=e.defer(),o=t[0].createElement("script");o.type="text/javascript",o.async=!0,o.src="http://d3js.org/d3.v4.min.js",o.onreadystatechange=function(){"complete"==this.readyState&&r()},o.onload=r;var i=t[0].getElementsByTagName("body")[0];return i.appendChild(o),{d3:function(){return n.promise}}}]),angular.module("app",["d3"]),angular.module("app").service("StockService",["$http","$q",function(t,e){var a="http://query.yahooapis.com/v1/public/yql?q=",r="&format=json&diagnostics=true&env=http://datatables.org/alltables.env";return{getCompanyDate:function(n){var o=a+encodeURI("select * from yahoo.finance.historicaldata where symbol in('"+n+"')and startDate = '2016-01-01' and endDate = '2016-06-30'")+r,i=e.defer();return t.get(o).then(function(t){var e=angular.fromJson(t.data.query.results);i.resolve(e)},function(t){i.reject({message:"Problem with connection"})}),i.promise}}}]),angular.module("app").controller("myController",["StockService",function(t){var e=this,a=[],r={};e.companiesNames=["CSCO","MSFT","ADBE"],e.showCompany=function(n){return r[n]?void(e.company=r[n]):(r[n]=[],void t.getCompanyDate(n).then(function(t){var o=t.quote;angular.forEach(o,function(t){t.Date=new Date(t.Date.split("-").join(",")),r[n].push(t),e.companyNames=a,e.company=r[n]})},function(t){alert(t.message)}))}}]),angular.module("app").directive("chart",["d3Service",function(t){function e(e,a){t.d3().then(function(t){e.$watch("item",function(e){function r(){if(!t.event.sourceEvent||"zoom"!==t.event.sourceEvent.type){var e=t.event.selection;m.domain(e.map(f.invert,f)),S.select(".area").attr("d",A),S.selectAll(".dot").attr("cx",function(t){return m(t.Date)}).attr("cy",function(t){return g(t.Close)}),S.select(".axis--x").call(x),h.domain();var a=e.map(f.invert,f);h.domain(o.map(function(t){if(a[0]<=t.Date&&t.Date<=a[1])return t.Date})),q.selectAll("rect").attr("x",function(t){if(a[0]<=t.Date&&t.Date<=a[1])return h(t.Date)}).attr("y",function(t){if(a[0]<=t.Date&&t.Date<=a[1])return y(t.High)}).attr("date",function(t){if(a[0]<=t.Date&&t.Date<=a[1])return t.Date}).attr("height",function(t){if(y(t.High),y(t.Low),a[0]<=t.Date&&t.Date<=a[1])return y(t.Low)-y(t.High)}).attr("width",h.bandwidth()),q.select(".axis--x").call(b).selectAll("text").text(function(e){if(e){var a=t.timeFormat("%m-%d");return a(e)}}).style("text-anchor","end").attr("dx","-.8em").attr("dy","-.55em").attr("transform","rotate(-90)")}}if(e){var n;t.select("#ID").remove();var o=angular.copy(e).reverse(),i={top:20,right:20,bottom:410,left:50},c={top:430,right:20,bottom:330,left:50},s={top:500,right:20,bottom:40,left:50},l=1200-i.left-i.right,d=800-i.top-i.bottom,p=800-c.top-c.bottom,u=800-s.top-s.bottom,m=t.scaleTime().range([0,l]),f=t.scaleTime().range([0,l]),h=t.scaleBand().rangeRound([0,l]).padding(.1).align(.1),g=t.scaleLinear().range([d,0]),v=t.scaleLinear().range([p,0]),y=t.scaleLinear().range([u,0]),x=t.axisBottom(m),D=t.axisBottom(f),b=t.axisBottom(h).tickFormat(t.timeFormat("%m-%d")),w=t.axisLeft(g),C=t.axisLeft(y),L=t.brushX().extent([[0,0],[l,p]]).on("brush",r);n=t.select(a[0]).append("svg").attr("id","ID").attr("width",l+i.left+i.right).attr("height",d+i.top+i.bottom),n.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",l).attr("height",d);var S=n.append("g").attr("class","focus").attr("transform","translate("+i.left+","+i.top+")"),H=n.append("g").attr("class","context").attr("transform","translate("+c.left+","+c.top+")"),q=n.append("g").attr("class","freg").attr("transform","translate("+s.left+","+s.top+")");m.domain(t.extent(o,function(t){return t.Date})),g.domain([t.min(o,function(t){return t.Low}),t.max(o,function(t){return t.High})]),f.domain(m.domain()),v.domain(g.domain()),h.domain(o.map(function(t){return t.Date})),y.domain(g.domain());var A=t.area().curve(t.curveMonotoneX).x(function(t){return m(t.Date)}).y0(d).y1(function(t){return g(t.Close)});S.append("path").data([o]).attr("class","area").attr("d",A);var B=S.append("g");B.attr("clip-path","url(#clip)"),B.selectAll("dot").data(o).enter().append("circle").attr("class","dot").attr("r",3).style("opacity",.5).attr("cx",function(t){return m(t.Date)}).attr("cy",function(t){return g(t.Close)}).on("mouseover",function(e){t.select(this).attr("r",7);var a=t.timeFormat("%e %B");E.html("<table><tr><td>Date</td><td>"+a(e.Date)+"</td></tr><tr><td>Open</td><td>"+e.Open+"</td></tr><tr><td>Close</td><td>"+e.Close+"</td></tr><tr><td>High</td><td>"+e.High+"</td></tr><tr><td>Low</td><td>"+e.Low+"</td></tr><tr><td>Volume</td><td>"+e.Volume+"</td></tr></table>").style("left",t.event.pageX+"px").style("top",t.event.pageY-parseInt(E.style("height"),10)+"px").transition().duration(200).style("opacity",.9)}).on("mouseout",function(e){t.select(this).attr("r",3),E.transition().duration(500).style("opacity",0)}),S.append("g").attr("class","axis axis--x").attr("fill","none").attr("transform","translate(0,"+d+")").call(x),S.append("g").attr("class","axis axis--y").call(w),S.append("text").attr("transform","rotate(-90)").attr("y",0-i.left).attr("x",0-d/2).attr("dy","1em").style("text-anchor","middle").text("Price"),n.append("text").attr("transform","translate("+(l+i.right+i.left)/2+" ,"+s.top+")").style("text-anchor","middle").text("Date");var E=t.select(a[0]).append("div").attr("class","tooltip").style("opacity",0);H.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+p+")").call(D),H.append("g").attr("class","brush").call(L).call(L.move,m.range());var $=t.area().curve(t.curveMonotoneX).x(function(t){return f(t.Date)}).y0(p).y1(function(t){return v(t.Close)});H.append("path").datum(o).attr("class","area").attr("d",$),q.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+u+")").call(b).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.55em").attr("transform","rotate(-90)"),q.append("g").attr("class","axis axis--y").call(C);q.selectAll("rect").data(o).enter().append("rect").attr("class","bar").attr("x",function(t){return h(t.Date)}).attr("y",function(t){return y(t.High)}).attr("height",function(t){return y(t.High),y(t.Low),y(t.Low)-y(t.High)}).attr("width",h.bandwidth())}})})}return{restrict:"E",scope:{item:"<?ngModel"},link:e}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImRpcmVjdGl2ZXMvY2hhcnQvY2hhcnQuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiJGRvY3VtZW50IiwiJHEiLCIkcm9vdFNjb3BlIiwib25TY3JpcHRMb2FkIiwiJGFwcGx5IiwiZCIsInJlc29sdmUiLCJ3aW5kb3ciLCJkMyIsImRlZmVyIiwic2NyaXB0VGFnIiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJhc3luYyIsInNyYyIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInRoaXMiLCJyZWFkeVN0YXRlIiwib25sb2FkIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiYXBwZW5kQ2hpbGQiLCJwcm9taXNlIiwic2VydmljZSIsIiRodHRwIiwiZG9tYWluIiwicXVlcnkiLCJnZXRDb21wYW55RGF0ZSIsIm5hbWUiLCJ1cmwiLCJlbmNvZGVVUkkiLCJkZWZlcnJlZCIsImdldCIsInRoZW4iLCJyZXNwb25zZSIsImRhdGUiLCJmcm9tSnNvbiIsImRhdGEiLCJyZXN1bHRzIiwiZXJyb3IiLCJyZWplY3QiLCJtZXNzYWdlIiwiY29udHJvbGxlciIsIlN0b2NrU2VydmljZSIsIm1vZGVsIiwiY29tcGFueU5hbWVzIiwiY29tcGFueSIsImNvbXBhbmllc05hbWVzIiwic2hvd0NvbXBhbnkiLCJxdW90ZSIsImZvckVhY2giLCJ2YWx1ZSIsIkRhdGUiLCJzcGxpdCIsImpvaW4iLCJwdXNoIiwiYWxlcnQiLCJkaXJlY3RpdmUiLCJkM1NlcnZpY2UiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiJHdhdGNoIiwiblZhbCIsImJydXNoZWQiLCJldmVudCIsInNvdXJjZUV2ZW50Iiwic2VsZWN0aW9uIiwieCIsIm1hcCIsIngyIiwiaW52ZXJ0IiwiZm9jdXMiLCJzZWxlY3QiLCJhdHRyIiwiYXJlYSIsInNlbGVjdEFsbCIsInkiLCJDbG9zZSIsImNhbGwiLCJ4QXhpcyIsIngzIiwicmFuZ2UiLCJmcmVnIiwieTMiLCJIaWdoIiwiTG93IiwiYmFuZHdpZHRoIiwieEF4aXMzIiwidGV4dCIsImZvcm1hdFRpbWUiLCJ0aW1lRm9ybWF0Iiwic3R5bGUiLCJzdmciLCJyZW1vdmUiLCJjb3B5IiwicmV2ZXJzZSIsIm1hcmdpbiIsInRvcCIsInJpZ2h0IiwiYm90dG9tIiwibGVmdCIsIm1hcmdpbjIiLCJtYXJnaW4zIiwid2lkdGgiLCJoZWlnaHQiLCJoZWlnaHQyIiwiaGVpZ2h0MyIsInNjYWxlVGltZSIsInNjYWxlQmFuZCIsInJhbmdlUm91bmQiLCJwYWRkaW5nIiwiYWxpZ24iLCJzY2FsZUxpbmVhciIsInkyIiwiYXhpc0JvdHRvbSIsInhBeGlzMiIsInRpY2tGb3JtYXQiLCJ5QXhpcyIsImF4aXNMZWZ0IiwieUF4aXMzIiwiYnJ1c2giLCJicnVzaFgiLCJleHRlbnQiLCJvbiIsImFwcGVuZCIsImNvbnRleHQiLCJtaW4iLCJtYXgiLCJjdXJ2ZSIsImN1cnZlTW9ub3RvbmVYIiwieTAiLCJ5MSIsImRvdHMiLCJlbnRlciIsImRpdiIsImh0bWwiLCJPcGVuIiwiVm9sdW1lIiwicGFnZVkiLCJwYXJzZUludCIsInRyYW5zaXRpb24iLCJkdXJhdGlvbiIsIm1vdmUiLCJhcmVhMiIsImRhdHVtIiwicmVzdHJpY3QiLCJpdGVtIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBQSxTQUFBQyxPQUFBLFNBQ0FDLFFBQUEsYUFBQSxZQUFBLEtBQUEsYUFDQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUdBLFFBQUFDLEtBRUFELEVBQUFFLE9BQUEsV0FBQUMsRUFBQUMsUUFBQUMsT0FBQUMsTUFKQSxHQUFBSCxHQUFBSixFQUFBUSxRQU9BQyxFQUFBVixFQUFBLEdBQUFXLGNBQUEsU0FDQUQsR0FBQUUsS0FBQSxrQkFDQUYsRUFBQUcsT0FBQSxFQUNBSCxFQUFBSSxJQUFBLCtCQUNBSixFQUFBSyxtQkFBQSxXQUNBLFlBQUFDLEtBQUFDLFlBQUFkLEtBRUFPLEVBQUFRLE9BQUFmLENBRUEsSUFBQWdCLEdBQUFuQixFQUFBLEdBQUFv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bi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2QzJywgW10pXG4gIC5mYWN0b3J5KCdkM1NlcnZpY2UnLCBbJyRkb2N1bWVudCcsICckcScsICckcm9vdFNjb3BlJyxcbiAgICBmdW5jdGlvbigkZG9jdW1lbnQsICRxLCAkcm9vdFNjb3BlKSB7XG4gICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIGZ1bmN0aW9uIG9uU2NyaXB0TG9hZCgpIHtcbiAgICAgICAgLy8gTG9hZCBjbGllbnQgaW4gdGhlIGJyb3dzZXJcbiAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7IGQucmVzb2x2ZSh3aW5kb3cuZDMpOyB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBzY3JpcHRUYWcgPSAkZG9jdW1lbnRbMF0uY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICBzY3JpcHRUYWcudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xuICAgICAgc2NyaXB0VGFnLmFzeW5jID0gdHJ1ZTtcbiAgICAgIHNjcmlwdFRhZy5zcmMgPSAnaHR0cDovL2QzanMub3JnL2QzLnY0Lm1pbi5qcyc7XG4gICAgICBzY3JpcHRUYWcub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT0gJ2NvbXBsZXRlJykgb25TY3JpcHRMb2FkKCk7XG4gICAgICB9O1xuICAgICAgc2NyaXB0VGFnLm9ubG9hZCA9IG9uU2NyaXB0TG9hZDtcblxuICAgICAgdmFyIHMgPSAkZG9jdW1lbnRbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTtcbiAgICAgIHMuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGQzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gZC5wcm9taXNlOyB9XG4gICAgICB9O1xuICAgIH1cbiAgXSk7XG5cblxuYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsnZDMnXSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5zZXJ2aWNlKCdTdG9ja1NlcnZpY2UnLCBbJyRodHRwJywgJyRxJywgZnVuY3Rpb24oJGh0dHAsICRxKSB7XG4gICAgdmFyIGRvbWFpbiA9IFwiaHR0cDovL3F1ZXJ5LnlhaG9vYXBpcy5jb20vdjEvcHVibGljL3lxbD9xPVwiO1xuICAgIHZhciBxdWVyeSA9IFwiJmZvcm1hdD1qc29uJmRpYWdub3N0aWNzPXRydWUmZW52PWh0dHA6Ly9kYXRhdGFibGVzLm9yZy9hbGx0YWJsZXMuZW52XCI7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZ2V0Q29tcGFueURhdGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgdmFyIHVybCA9IGRvbWFpbiArXG4gICAgICAgICAgZW5jb2RlVVJJKFwic2VsZWN0ICogZnJvbSB5YWhvby5maW5hbmNlLmhpc3RvcmljYWxkYXRhIHdoZXJlIHN5bWJvbCBpbignXCIgKyBuYW1lICtcbiAgICAgICAgICAgIFwiJylhbmQgc3RhcnREYXRlID0gJzIwMTYtMDEtMDEnIGFuZCBlbmREYXRlID0gJzIwMTYtMDYtMzAnXCIpICtcbiAgICAgICAgICBxdWVyeTtcblxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgdmFyIGRhdGUgPSBhbmd1bGFyLmZyb21Kc29uKHJlc3BvbnNlLmRhdGEucXVlcnkucmVzdWx0cyk7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoeyBtZXNzYWdlOiAnUHJvYmxlbSB3aXRoIGNvbm5lY3Rpb24nIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdteUNvbnRyb2xsZXInLCBbJ1N0b2NrU2VydmljZScsIGZ1bmN0aW9uKFN0b2NrU2VydmljZSkge1xuICAgIHZhciBtb2RlbCA9IHRoaXM7XG4gICAgdmFyIGNvbXBhbnlOYW1lcyA9IFtdO1xuICAgIHZhciBjb21wYW55ID0ge307XG4gICAgbW9kZWwuY29tcGFuaWVzTmFtZXMgPSBbJ0NTQ08nLCAnTVNGVCcsICdBREJFJ107XG5cbiAgICBtb2RlbC5zaG93Q29tcGFueSA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIGlmICghIWNvbXBhbnlbbmFtZV0pIHtcbiAgICAgICAgbW9kZWwuY29tcGFueSA9IGNvbXBhbnlbbmFtZV07XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbXBhbnlbbmFtZV0gPSBbXTtcbiAgICAgIFN0b2NrU2VydmljZS5nZXRDb21wYW55RGF0ZShuYW1lKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UucXVvdGU7XG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIHZhbHVlLkRhdGUgPSBuZXcgRGF0ZSh2YWx1ZS5EYXRlLnNwbGl0KCctJykuam9pbignLCcpKTtcbiAgICAgICAgICBjb21wYW55W25hbWVdLnB1c2godmFsdWUpO1xuICAgICAgICAgIG1vZGVsLmNvbXBhbnlOYW1lcyA9IGNvbXBhbnlOYW1lcztcbiAgICAgICAgICBtb2RlbC5jb21wYW55ID0gY29tcGFueVtuYW1lXTtcblxuICAgICAgICB9KTtcbiAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIGFsZXJ0KGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuXG5dKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnY2hhcnQnLCBbJ2QzU2VydmljZScsIGZ1bmN0aW9uKGQzU2VydmljZSkge1xuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgc2NvcGU6IHtcbiAgICAgIGl0ZW06ICc8P25nTW9kZWwnXG4gICAgfSxcbiAgICBsaW5rOiBsaW5rXG4gIH07XG5cblxuIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQpIHtcbiAgICAgIGZ1bmN0aW9uIGdldERhdGUoZGF0ZSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSk7XG4gICAgICB9XG4gICAgICBkM1NlcnZpY2UuZDMoKS50aGVuKGZ1bmN0aW9uKGQzKSB7XG5cbiAgICAgICAgc2NvcGUuJHdhdGNoKCdpdGVtJywgZnVuY3Rpb24oblZhbCkge1xuICAgICAgICAgIGlmICghIW5WYWwpIHtcbiAgICAgICAgICAgIHZhciBzdmc7XG4gICAgICAgICAgICBkMy5zZWxlY3QoXCIjSURcIikucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0gYW5ndWxhci5jb3B5KG5WYWwpLnJldmVyc2UoKTtcblxuICAgICAgICAgICAgdmFyIG1hcmdpbiA9IHsgdG9wOiAyMCwgcmlnaHQ6IDIwLCBib3R0b206IDQxMCwgbGVmdDogNTAgfSxcbiAgICAgICAgICAgICAgbWFyZ2luMiA9IHsgdG9wOiA0MzAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMzAsIGxlZnQ6IDUwIH0sXG4gICAgICAgICAgICAgIG1hcmdpbjMgPSB7IHRvcDogNTAwLCByaWdodDogMjAsIGJvdHRvbTogNDAsIGxlZnQ6IDUwIH0sXG4gICAgICAgICAgICAgIHdpZHRoID0gMTIwMCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0LFxuICAgICAgICAgICAgICBoZWlnaHQgPSA4MDAgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSxcbiAgICAgICAgICAgICAgaGVpZ2h0MiA9IDgwMCAtIG1hcmdpbjIudG9wIC0gbWFyZ2luMi5ib3R0b20sXG4gICAgICAgICAgICAgIGhlaWdodDMgPSA4MDAgLSBtYXJnaW4zLnRvcCAtIG1hcmdpbjMuYm90dG9tO1xuXG4gICAgICAgICAgICB2YXIgeCA9IGQzLnNjYWxlVGltZSgpLnJhbmdlKFswLCB3aWR0aF0pLFxuICAgICAgICAgICAgICB4MiA9IGQzLnNjYWxlVGltZSgpLnJhbmdlKFswLCB3aWR0aF0pLFxuICAgICAgICAgICAgICB4MyA9IGQzLnNjYWxlQmFuZCgpLnJhbmdlUm91bmQoWzAsIHdpZHRoXSkucGFkZGluZygwLjEpLmFsaWduKDAuMSksXG4gICAgICAgICAgICAgIHkgPSBkMy5zY2FsZUxpbmVhcigpLnJhbmdlKFtoZWlnaHQsIDBdKSxcbiAgICAgICAgICAgICAgeTIgPSBkMy5zY2FsZUxpbmVhcigpLnJhbmdlKFtoZWlnaHQyLCAwXSksXG4gICAgICAgICAgICAgIHkzID0gZDMuc2NhbGVMaW5lYXIoKS5yYW5nZShbaGVpZ2h0MywgMF0pO1xuXG4gICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5heGlzQm90dG9tKHgpLFxuICAgICAgICAgICAgICB4QXhpczIgPSBkMy5heGlzQm90dG9tKHgyKSxcbiAgICAgICAgICAgICAgeEF4aXMzID0gZDMuYXhpc0JvdHRvbSh4MykudGlja0Zvcm1hdChkMy50aW1lRm9ybWF0KFwiJW0tJWRcIikpLFxuICAgICAgICAgICAgICB5QXhpcyA9IGQzLmF4aXNMZWZ0KHkpLFxuICAgICAgICAgICAgICB5QXhpczMgPSBkMy5heGlzTGVmdCh5Myk7XG5cbiAgICAgICAgICAgIHZhciBicnVzaCA9IGQzLmJydXNoWCgpXG4gICAgICAgICAgICAgIC5leHRlbnQoW1xuICAgICAgICAgICAgICAgIFswLCAwXSxcbiAgICAgICAgICAgICAgICBbd2lkdGgsIGhlaWdodDJdXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgIC5vbihcImJydXNoXCIsIGJydXNoZWQpO1xuXG4gICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbWVudFswXSkuYXBwZW5kKFwic3ZnXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgXCJJRFwiKVxuICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKTtcblxuICAgICAgICAgICAgc3ZnLmFwcGVuZChcImRlZnNcIikuYXBwZW5kKFwiY2xpcFBhdGhcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJpZFwiLCBcImNsaXBcIilcbiAgICAgICAgICAgICAgLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KTtcblxuICAgICAgICAgICAgdmFyIGZvY3VzID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImZvY3VzXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQgKyBcIixcIiArIG1hcmdpbi50b3AgKyBcIilcIik7XG5cbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNvbnRleHRcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4yLmxlZnQgKyBcIixcIiArIG1hcmdpbjIudG9wICsgXCIpXCIpO1xuXG4gICAgICAgICAgICB2YXIgZnJlZyA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJmcmVnXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luMy5sZWZ0ICsgXCIsXCIgKyBtYXJnaW4zLnRvcCArIFwiKVwiKTtcblxuXG5cblxuICAgICAgICAgICAgeC5kb21haW4oZDMuZXh0ZW50KGRhdGEsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGQuRGF0ZTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHkuZG9tYWluKFtkMy5taW4oZGF0YSwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICByZXR1cm4gZC5Mb3c7XG4gICAgICAgICAgICB9KSwgZDMubWF4KGRhdGEsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGQuSGlnaDtcbiAgICAgICAgICAgIH0pXSk7XG4gICAgICAgICAgICB4Mi5kb21haW4oeC5kb21haW4oKSk7XG4gICAgICAgICAgICB5Mi5kb21haW4oeS5kb21haW4oKSk7XG4gICAgICAgICAgICAvL3gzLmRvbWFpbih4LmRvbWFpbigpKTtcbiAgICAgICAgICAgIHgzLmRvbWFpbihkYXRhLm1hcChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkLkRhdGU7XG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgIHkzLmRvbWFpbih5LmRvbWFpbigpKTtcblxuXG4gICAgICAgICAgICB2YXIgYXJlYSA9IGQzLmFyZWEoKVxuICAgICAgICAgICAgICAuY3VydmUoZDMuY3VydmVNb25vdG9uZVgpXG4gICAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geChkLkRhdGUpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAueTAoaGVpZ2h0KVxuICAgICAgICAgICAgICAueTEoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5KGQuQ2xvc2UpO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9jdXMuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgICAgICAgICAuZGF0YShbZGF0YV0pXG4gICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJhcmVhXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBhcmVhKTtcblxuXG4gICAgICAgICAgICAvLyBhcHBlbmQgc2NhdHRlciBwbG90IHRvIG1haW4gY2hhcnQgYXJlYVxuICAgICAgICAgICAgdmFyIGRvdHMgPSBmb2N1cy5hcHBlbmQoXCJnXCIpO1xuICAgICAgICAgICAgZG90cy5hdHRyKFwiY2xpcC1wYXRoXCIsIFwidXJsKCNjbGlwKVwiKTtcbiAgICAgICAgICAgIGRvdHMuc2VsZWN0QWxsKFwiZG90XCIpXG4gICAgICAgICAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnZG90JylcbiAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsIDMpXG4gICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgLjUpXG4gICAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB4KGQuRGF0ZSk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5KGQuQ2xvc2UpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigncicsIDcpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdFRpbWUgPSBkMy50aW1lRm9ybWF0KFwiJWUgJUJcIilcblxuXG4gICAgICAgICAgICAgICAgZGl2Lmh0bWwoXG4gICAgICAgICAgICAgICAgICAgICc8dGFibGU+JyArICc8dHI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8dGQ+JyArICdEYXRlJyArICc8L3RkPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHRkPicgKyBmb3JtYXRUaW1lKGQuRGF0ZSkgKyAnPC90ZD4nICsgJzwvdHI+JyArICc8dHI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8dGQ+JyArICdPcGVuJyArICc8L3RkPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHRkPicgKyBkLk9wZW4gKyAnPC90ZD4nICsgJzwvdHI+JyArICc8dHI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8dGQ+JyArICdDbG9zZScgKyAnPC90ZD4nICtcbiAgICAgICAgICAgICAgICAgICAgJzx0ZD4nICsgZC5DbG9zZSArICc8L3RkPicgKyAnPC90cj4nICsgJzx0cj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzx0ZD4nICsgJ0hpZ2gnICsgJzwvdGQ+JyArXG4gICAgICAgICAgICAgICAgICAgICc8dGQ+JyArIGQuSGlnaCArICc8L3RkPicgKyAnPC90cj4nICsgJzx0cj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzx0ZD4nICsgJ0xvdycgKyAnPC90ZD4nICtcbiAgICAgICAgICAgICAgICAgICAgJzx0ZD4nICsgZC5Mb3cgKyAnPC90ZD4nICsgJzwvdHI+JyArICc8dHI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8dGQ+JyArICdWb2x1bWUnICsgJzwvdGQ+JyArXG4gICAgICAgICAgICAgICAgICAgICc8dGQ+JyArIGQuVm9sdW1lICsgJzwvdGQ+JyArICc8L3RyPicgKyAnPC90YWJsZT4nXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCkgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZIC0gcGFyc2VJbnQoZGl2LnN0eWxlKCdoZWlnaHQnKSwgMTApKSArIFwicHhcIilcbiAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbigyMDApXG4gICAgICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIC45KVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCdyJywgMyk7XG4gICAgICAgICAgICAgICAgZGl2LnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKDUwMClcbiAgICAgICAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmb2N1cy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJheGlzIGF4aXMtLXhcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0ICsgXCIpXCIpXG4gICAgICAgICAgICAgIC5jYWxsKHhBeGlzKTtcblxuICAgICAgICAgICAgZm9jdXMuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYXhpcyBheGlzLS15XCIpXG4gICAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcblxuICAgICAgICAgICAgZm9jdXMuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAwIC0gbWFyZ2luLmxlZnQpXG4gICAgICAgICAgICAgIC5hdHRyKFwieFwiLCAwIC0gKGhlaWdodCAvIDIpKVxuICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiMWVtXCIpXG4gICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAgIC50ZXh0KFwiUHJpY2VcIik7XG5cbiAgICAgICAgICAgIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsXG4gICAgICAgICAgICAgICAgXCJ0cmFuc2xhdGUoXCIgKyAoKHdpZHRoICsgbWFyZ2luLnJpZ2h0ICsgbWFyZ2luLmxlZnQpIC8gMikgKyBcIiAsXCIgK1xuICAgICAgICAgICAgICAgIG1hcmdpbjMudG9wICsgXCIpXCIpXG4gICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAgIC50ZXh0KFwiRGF0ZVwiKTtcblxuICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBkaXYgZm9yIHRoZSB0b29sdGlwXG4gICAgICAgICAgICB2YXIgZGl2ID0gZDMuc2VsZWN0KGVsZW1lbnRbMF0pLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidG9vbHRpcFwiKVxuICAgICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xuXG5cblxuICAgICAgICAgICAgLy8gYXBwZW5kIHNjYXR0ZXIgcGxvdCB0byBicnVzaCBjaGFydCBhcmVhXG4gICAgICAgICAgICBjb250ZXh0LmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImF4aXMgYXhpcy0teFwiKVxuICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0MiArIFwiKVwiKVxuICAgICAgICAgICAgICAuY2FsbCh4QXhpczIpO1xuXG4gICAgICAgICAgICBjb250ZXh0LmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJydXNoXCIpXG4gICAgICAgICAgICAgIC5jYWxsKGJydXNoKVxuICAgICAgICAgICAgICAuY2FsbChicnVzaC5tb3ZlLCB4LnJhbmdlKCkpO1xuXG4gICAgICAgICAgICB2YXIgYXJlYTIgPSBkMy5hcmVhKClcbiAgICAgICAgICAgICAgLmN1cnZlKGQzLmN1cnZlTW9ub3RvbmVYKVxuICAgICAgICAgICAgICAueChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHgyKGQuRGF0ZSk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC55MChoZWlnaHQyKVxuICAgICAgICAgICAgICAueTEoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5MihkLkNsb3NlKTtcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRleHQuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgICAgICAgICAuZGF0dW0oZGF0YSlcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImFyZWFcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJkXCIsIGFyZWEyKTtcblxuXG4gICAgICAgICAgICBmcmVnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImF4aXMgYXhpcy0teFwiKVxuICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0MyArIFwiKVwiKVxuICAgICAgICAgICAgICAuY2FsbCh4QXhpczMpXG4gICAgICAgICAgICAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgXCItLjhlbVwiKVxuICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLS41NWVtXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwicm90YXRlKC05MClcIik7XG5cbiAgICAgICAgICAgIGZyZWcuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYXhpcyBheGlzLS15XCIpXG4gICAgICAgICAgICAgIC5jYWxsKHlBeGlzMyk7XG5cbiAgICAgICAgICAgIC8vIEFkZCBhIHJlY3QgZm9yIGVhY2ggZGF0ZS5cbiAgICAgICAgICAgIHZhciByZWN0ID0gZnJlZy5zZWxlY3RBbGwoXCJyZWN0XCIpXG4gICAgICAgICAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhclwiKVxuICAgICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB4MyhkLkRhdGUpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5MyhkLkhpZ2gpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgeTMoZC5IaWdoKTtcbiAgICAgICAgICAgICAgICB5MyhkLkxvdyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4geTMoZC5Mb3cpIC0geTMoZC5IaWdoKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB4My5iYW5kd2lkdGgoKSk7XG5cblxuXG4gICAgICAgICAgICAvL2NyZWF0ZSBicnVzaCBmdW5jdGlvbiByZWRyYXcgc2NhdHRlcnBsb3Qgd2l0aCBzZWxlY3Rpb25cbiAgICAgICAgICAgIGZ1bmN0aW9uIGJydXNoZWQoKSB7XG5cbiAgICAgICAgICAgICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50ICYmIGQzLmV2ZW50LnNvdXJjZUV2ZW50LnR5cGUgPT09IFwiem9vbVwiKSByZXR1cm47IC8vIGlnbm9yZSBicnVzaC1ieS16b29tXG5cblxuICAgICAgICAgICAgICB2YXIgc2VsZWN0aW9uID0gZDMuZXZlbnQuc2VsZWN0aW9uO1xuICAgICAgICAgICAgICB4LmRvbWFpbihzZWxlY3Rpb24ubWFwKHgyLmludmVydCwgeDIpKTtcbiAgICAgICAgICAgICAgZm9jdXMuc2VsZWN0KFwiLmFyZWFcIikuYXR0cihcImRcIiwgYXJlYSk7XG4gICAgICAgICAgICAgIGZvY3VzLnNlbGVjdEFsbChcIi5kb3RcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImN4XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB4KGQuRGF0ZSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB5KGQuQ2xvc2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBmb2N1cy5zZWxlY3QoXCIuYXhpcy0teFwiKS5jYWxsKHhBeGlzKTtcblxuICAgICAgICAgICAgICB4My5kb21haW4oKTtcblxuXG4gICAgICAgICAgICAgIHZhciByYW5nZSA9IHNlbGVjdGlvbi5tYXAoeDIuaW52ZXJ0LCB4Mik7XG5cbiAgICAgICAgICAgICAgeDMuZG9tYWluKGRhdGEubWFwKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmFuZ2VbMF0gPD0gZC5EYXRlICYmIGQuRGF0ZSA8PSByYW5nZVsxXSlcbiAgICAgICAgICAgICAgICAgIHJldHVybiBkLkRhdGU7XG4gICAgICAgICAgICAgIH0pKTtcblxuXG4gICAgICAgICAgICAgIGZyZWcuc2VsZWN0QWxsKFwicmVjdFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkKSB7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChyYW5nZVswXSA8PSBkLkRhdGUgJiYgZC5EYXRlIDw9IHJhbmdlWzFdKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geDMoZC5EYXRlKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgICBpZiAocmFuZ2VbMF0gPD0gZC5EYXRlICYmIGQuRGF0ZSA8PSByYW5nZVsxXSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkzKGQuSGlnaCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignZGF0ZScsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChyYW5nZVswXSA8PSBkLkRhdGUgJiYgZC5EYXRlIDw9IHJhbmdlWzFdKVxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuRGF0ZTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHtcblxuICAgICAgICAgICAgICAgICAgeTMoZC5IaWdoKTtcbiAgICAgICAgICAgICAgICAgIHkzKGQuTG93KTtcblxuICAgICAgICAgICAgICAgICAgaWYgKHJhbmdlWzBdIDw9IGQuRGF0ZSAmJiBkLkRhdGUgPD0gcmFuZ2VbMV0pXG4gICAgICAgICAgICAgICAgICByZXR1cm4geTMoZC5Mb3cpIC0geTMoZC5IaWdoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgeDMuYmFuZHdpZHRoKCkpO1xuXG4gICAgICAgICAgICAgIGZyZWcuc2VsZWN0KFwiLmF4aXMtLXhcIikuY2FsbCh4QXhpczMpXG4gICAgICAgICAgICAgICAgLnNlbGVjdEFsbChcInRleHRcIilcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7XG5cbiAgICAgICAgICAgICAgICAgIGlmKCEhZCl7XG4gICAgICAgICAgICAgICAgICAgdmFyIGZvcm1hdFRpbWUgPSBkMy50aW1lRm9ybWF0KFwiJW0tJWRcIik7XG4gICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRpbWUoZCk7XG4gICAgICAgICAgICAgICAgICB9fSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZHhcIiwgXCItLjhlbVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCItLjU1ZW1cIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgfVxuXG5cblxuXG5cblxuXG5cblxuXG5cblxufV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
